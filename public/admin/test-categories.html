<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Categories Test Page</h1>
        <div id="alert-container"></div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>Test Results:</h3>
                <div id="test-results"></div>
            </div>
            <div class="col-md-6">
                <h3>Categories Data:</h3>
                <div id="categories-data"></div>
            </div>
        </div>
        
        <div class="mt-4">
            <button id="test-api" class="btn btn-primary">Test API</button>
            <button id="test-auth" class="btn btn-secondary">Test Auth</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test functions
        const showAlert = (message, type = 'danger', container = 'alert-container') => {
            const alertContainer = document.getElementById(container);
            if (!alertContainer) return;

            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;

            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
        };

        const getAuthToken = () => {
            return localStorage.getItem('adminToken') || localStorage.getItem('token') || sessionStorage.getItem('token');
        };

        const addTestResult = (message, success = true) => {
            const resultsDiv = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `alert alert-${success ? 'success' : 'danger'} py-2`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        };

        const testAuth = () => {
            const token = getAuthToken();
            if (token) {
                addTestResult('✓ Auth token found', true);
                document.getElementById('categories-data').innerHTML = `<pre>Token: ${token.substring(0, 20)}...</pre>`;
            } else {
                addTestResult('✗ No auth token found', false);
                showAlert('Please login first at <a href="/admin/login.html">login page</a>', 'warning');
            }
        };

        const testAPI = async () => {
            try {
                addTestResult('Testing API connection...');
                
                const token = getAuthToken();
                if (!token) {
                    addTestResult('✗ No token available', false);
                    return;
                }

                const headers = {
                    'Authorization': `Bearer ${token}`
                };

                const response = await fetch('http://localhost:5000/api/categories', { headers });
                addTestResult(`API Response Status: ${response.status}`, response.ok);

                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`✓ Received ${data.length} categories`, true);
                    document.getElementById('categories-data').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    const errorText = await response.text();
                    addTestResult(`✗ API Error: ${errorText}`, false);
                }
            } catch (error) {
                addTestResult(`✗ Network Error: ${error.message}`, false);
                console.error('API Test Error:', error);
            }
        };

        // Event listeners
        document.getElementById('test-auth').addEventListener('click', testAuth);
        document.getElementById('test-api').addEventListener('click', testAPI);

        // Auto-run tests on load
        document.addEventListener('DOMContentLoaded', () => {
            addTestResult('Page loaded successfully', true);
            testAuth();
        });
    </script>
</body>
</html>